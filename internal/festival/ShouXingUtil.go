package festival

import (
	"math"
	"strings"
)

// 天文计算常量
const Pi2 = 2 * math.Pi
const OneThird = float64(1) / 3
const SecondPerDay = 86400
const SecondPerRad = 180 * 3600 / math.Pi

// 章动系数
var NutB = []float64{
	2.1824, -33.75705, 36e-6, -1720, 920,
	3.5069, 1256.66393, 11e-6, -132, 57,
	1.3375, 16799.4182, -51e-6, -23, 10,
	4.3649, -67.5141, 72e-6, 21, -9,
	0.04, -628.302, 0, -14, 0,
	2.36, 8328.691, 0, 7, 0,
	3.46, 1884.966, 0, -5, 2,
	5.44, 16833.175, 0, -4, 2,
	3.69, 25128.110, 0, -3, 0,
	3.55, 628.362, 0, 2, 0,
}

// Delta T计算表
var DtAt = []float64{
	-4000, 108371.7, -13036.80, 392.000, 0.0000,
	-500, 17201.0, -627.82, 16.170, -0.3413,
	-150, 12200.6, -346.41, 5.403, -0.1593,
	150, 9113.8, -328.13, -1.647, 0.0377,
	500, 5707.5, -391.41, 0.915, 0.3145,
	900, 2203.4, -283.45, 13.034, -0.1778,
	1300, 490.1, -57.35, 2.085, -0.0072,
	1600, 120.0, -9.81, -1.532, 0.1403,
	1700, 10.2, -0.91, 0.510, -0.0370,
	1800, 13.4, -0.72, 0.202, -0.0193,
	1830, 7.8, -1.81, 0.416, -0.0247,
	1860, 8.3, -0.13, -0.406, 0.0292,
	1880, -5.4, 0.32, -0.183, 0.0173,
	1900, -2.3, 2.06, 0.169, -0.0135,
	1920, 21.2, 1.69, -0.304, 0.0167,
	1940, 24.2, 1.22, -0.064, 0.0031,
	1960, 33.2, 0.51, 0.231, -0.0109,
	1980, 51.0, 1.29, -0.026, 0.0032,
	2000, 63.87, 0.1, 0, 0,
	2005, 64.7, 0.21, 0, 0,
	2012, 66.8, 0.22, 0, 0,
	2016, 68.1024, 0.5456, -0.0542, -0.001172,
	2020, 69.3612, 0.0422, -0.0502, 0.006216,
	2024, 69.1752, -0.0335, -0.0048, 0.000811,
	2028, 69.0206, -0.0275, 0.0055, -0.000014,
	2032, 68.9981, 0.0163, 0.0054, 0.000006,
	2036, 69.1498, 0.0599, 0.0053, 0.000026,
	2040, 69.4751, 0.1035, 0.0051, 0.000046,
	2044, 69.9737, 0.1469, 0.0050, 0.000066,
	2048, 70.6451, 0.1903, 0.0049, 0.000085,
	2050, 71.0457,
}

// 节气计算表
var QiKb = []float64{
	1640650.479938, 15.21842500,
	1642476.703182, 15.21874996,
	1683430.515601, 15.218750011,
	1752157.640664, 15.218749978,
	1807675.003759, 15.218620279,
	1883627.765182, 15.218612292,
	1907369.128100, 15.218449176,
	1936603.140413, 15.218425000,
	1939145.524180, 15.218466998,
	1947180.798300, 15.218524844,
	1964362.041824, 15.218533526,
	1987372.340971, 15.218513908,
	1999653.819126, 15.218530782,
	2007445.469786, 15.218535181,
	2021324.917146, 15.218526248,
	2047257.232342, 15.218519654,
	2070282.898213, 15.218425000,
	2073204.872850, 15.218515221,
	2080144.500926, 15.218530782,
	2086703.688963, 15.218523776,
	2110033.182763, 15.218425000,
	2111190.300888, 15.218425000,
	2113731.271005, 15.218515671,
	2120670.840263, 15.218425000,
	2123973.309063, 15.218425000,
	2125068.997336, 15.218477932,
	2136026.312633, 15.218472436,
	2156099.495538, 15.218425000,
	2159021.324663, 15.218425000,
	2162308.575254, 15.218461742,
	2178485.706538, 15.218425000,
	2178759.662849, 15.218445786,
	2185334.020800, 15.218425000,
	2187525.481425, 15.218425000,
	2188621.191481, 15.218437494,
	2322147.76,
}

// 朔日计算表
var ShuoKb = []float64{1457698.231017, 29.53067166, 1546082.512234, 29.53085106, 1640640.735300, 29.53060000, 1642472.151543, 29.53085439, 1683430.509300, 29.53086148, 1752148.041079, 29.53085097, 1807665.420323, 29.53059851, 1883618.114100, 29.53060000, 1907360.704700, 29.53060000, 1936596.224900, 29.53060000, 1939135.675300, 29.53060000, 1947168.00}

// 节气修正表
var QB = decode("FrcFs22AFsckF2tsDtFqEtF1posFdFgiFseFtmelpsEfhkF2anmelpFlF1ikrotcnEqEq2FfqmcDsrFor22FgFrcgDscFs22FgEeFtE2sfFs22sCoEsaF2tsD1FpeE2eFsssEciFsFnmelpFcFhkF2tcnEqEpFgkrotcnEqrEtFermcDsrE222FgBmcmr22DaEfnaF222sD1FpeForeF2tssEfiFpEoeFssD1iFstEqFppDgFstcnEqEpFg11FscnEqrAoAF2ClAEsDmDtCtBaDlAFbAEpAAAAAD2FgBiBqoBbnBaBoAAAAAAAEgDqAdBqAFrBaBoACdAAf1AACgAAAeBbCamDgEifAE2AABa1C1BgFdiAAACoCeE1ADiEifDaAEqAAFe1AcFbcAAAAAF1iFaAAACpACmFmAAAAAAAACrDaAAADG0")

// 朔日修正表
var SB = decode("EqoFscDcrFpmEsF2DfFideFelFpFfFfFiaipqti1ksttikptikqckstekqttgkqttgkqteksttikptikq2fjstgjqttjkqttgkqtekstfkptikq2tijstgjiFkirFsAeACoFsiDaDiADc1AFbBfgdfikijFifegF1FhaikgFag1E2btaieeibggiffdeigFfqDfaiBkF1kEaikhkigeidhhdiegcFfakF1ggkidbiaedksaFffckekidhhdhdikcikiakicjF1deedFhFccgicdekgiFbiaikcfi1kbFibefgEgFdcFkFeFkdcfkF1kfkcickEiFkDacFiEfbiaejcFfffkhkdgkaiei1ehigikhdFikfckF1dhhdikcfgjikhfjicjicgiehdikcikggcifgiejF1jkieFhegikggcikFegiegkfjebhigikggcikdgkaFkijcfkcikfkcifikiggkaeeigefkcdfcfkhkdgkegieidhijcFfakhfgeidieidiegikhfkfckfcjbdehdikggikgkfkicjicjF1dbidikFiggcifgiejkiegkigcdiegfggcikdbgfgefjF1kfegikggcikdgFkeeijcfkcikfkekcikdgkabhkFikaffcfkhkdgkegbiaekfkiakicjhfgqdq2fkiakgkfkhfkfcjiekgFebicggbedF1jikejbbbiakgbgkacgiejkijjgigfiakggfggcibFifjefjF1kfekdgjcibFeFkijcfkfhkfkeaieigekgbhkfikidfcjeaibgekgdkiffiffkiakF1jhbakgdki1dj1ikfkicjicjieeFkgdkicggkighdF1jfgkgfgbdkicggfggkidFkiekgijkeigfiskiggfaidheigF1jekijcikickiggkidhhdbgcfkFikikhkigeidieFikggikhkffaffijhidhhakgdkhkijF1kiakF1kfheakgdkifiggkigicjiejkieedikgdfcggkigieeiejfgkgkigbgikicggkiaideeijkefjeijikhkiggkiaidheigcikaikffikijgkiahi1hhdikgjfifaakekighie1hiaikggikhkffakicjhiahaikggikhkijF1kfejfeFhidikggiffiggkigicjiekgieeigikggiffiggkidheigkgfjkeigiegikifiggkidhedeijcfkFikikhkiggkidhh1ehigcikaffkhkiggkidhh1hhigikekfiFkFikcidhh1hitcikggikhkfkicjicghiediaikggikhkijbjfejfeFhaikggifikiggkigiejkikgkgieeigikggiffiggkigieeigekijcijikggifikiggkideedeijkefkfckikhkiggkidhh1ehijcikaffkhkiggkidhh1hhigikhkikFikfckcidhh1hiaikgjikhfjicjicgiehdikcikggifikigiejfejkieFhegikggifikiggfghigkfjeijkhigikggifikiggkigieeijcijcikfksikifikiggkidehdeijcfdckikhkiggkhghh1ehijikifffffkhsFngErD1pAfBoDd1BlEtFqA2AqoEpDqElAEsEeB2BmADlDkqBtC1FnEpDqnEmFsFsAFnllBbFmDsDiCtDmAB2BmtCgpEplCpAEiBiEoFqFtEqsDcCnFtADnFlEgdkEgmEtEsCtDmADqFtAFrAtEcCqAE1BoFqC1F1DrFtBmFtAC2ACnFaoCgADcADcCcFfoFtDlAFgmFqBq2bpEoAEmkqnEeCtAE1bAEqgDfFfCrgEcBrACfAAABqAAB1AAClEnFeCtCgAADqDoBmtAAACbFiAAADsEtBqAB2FsDqpFqEmFsCeDtFlCeDtoEpClEqAAFrAFoCgFmFsFqEnAEcCqFeCtFtEnAEeFtAAEkFnErAABbFkADnAAeCtFeAfBoAEpFtAABtFqAApDcCGJ")

func decode(s string) string {
	o := "0000000000"
	o2 := o + o
	s = strings.Replace(s, "J", "00", -1)
	s = strings.Replace(s, "I", "000", -1)
	s = strings.Replace(s, "H", "0000", -1)
	s = strings.Replace(s, "G", "00000", -1)
	s = strings.Replace(s, "t", "02", -1)
	s = strings.Replace(s, "s", "002", -1)
	s = strings.Replace(s, "r", "0002", -1)
	s = strings.Replace(s, "q", "00002", -1)
	s = strings.Replace(s, "p", "000002", -1)
	s = strings.Replace(s, "o", "0000002", -1)
	s = strings.Replace(s, "n", "00000002", -1)
	s = strings.Replace(s, "m", "000000002", -1)
	s = strings.Replace(s, "l", "0000000002", -1)
	s = strings.Replace(s, "k", "01", -1)
	s = strings.Replace(s, "j", "0101", -1)
	s = strings.Replace(s, "i", "001", -1)
	s = strings.Replace(s, "h", "001001", -1)
	s = strings.Replace(s, "g", "0001", -1)
	s = strings.Replace(s, "f", "00001", -1)
	s = strings.Replace(s, "e", "000001", -1)
	s = strings.Replace(s, "d", "0000001", -1)
	s = strings.Replace(s, "c", "00000001", -1)
	s = strings.Replace(s, "b", "000000001", -1)
	s = strings.Replace(s, "a", "0000000001", -1)
	s = strings.Replace(s, "A", o2+o2+o2, -1)
	s = strings.Replace(s, "B", o2+o2+o, -1)
	s = strings.Replace(s, "C", o2+o2, -1)
	s = strings.Replace(s, "D", o2+o, -1)
	s = strings.Replace(s, "E", o2, -1)
	s = strings.Replace(s, "F", o, -1)
	return s
}

// XL0 太阳黄经计算表
var XL0 = []float64{
	10000000000,
	20, 578, 920, 1100, 1124, 1136, 1148, 1217, 1226, 1229, 1229, 1229, 1229, 1937, 2363, 2618, 2633, 2660, 2666,
	17534704567, 0.00000000000, 0.00000000000, 334165646, 4.669256804, 6283.075849991, 3489428, 4.6261024,
	12566.1517000, 349706, 2.744118, 5753.384885, 341757, 2.828866, 3.523118, 313590, 3.627670, 77713.771468,
	267622, 4.418084, 7860.419392, 234269, 6.135162, 3930.209696, 132429, 0.742464, 11506.769770, 127317, 2.037097,
	529.690965, 119917, 1.109629, 1577.343542, 99025, 5.23268, 5884.92685, 90186, 2.04505, 26.29832, 85722, 3.50849,
	398.14900, 77979, 1.17883, 5223.69392, 75314, 2.53339, 5507.55324, 50526, 4.58293, 18849.22755, 49238, 4.20507,
	775.52261, 35666, 2.91954, 0.06731, 31709, 5.84902, 11790.62909, 28413, 1.89869, 796.29801, 27104, 0.31489,
	10977.07880, 24281, 0.34481, 5486.77784, 20616, 4.80647, 2544.31442, 20539, 1.86948, 5573.14280, 20226, 2.45768,
	6069.77675, 15552, 0.83306, 213.29910, 13221, 3.41118, 2942.46342, 12618, 1.08303, 20.77540, 11513, 0.64545,
	0.98032, 10285, 0.63600, 4694.00295, 10190, 0.97569, 15720.83878, 10172, 4.26680, 7.11355, 9921, 6.2099,
	2146.1654, 9761, 0.6810, 155.4204, 8580, 5.9832, 161000.6857, 8513, 1.2987, 6275.9623, 8471, 3.6708, 71430.6956,
	7964, 1.8079, 17260.1547, 7876, 3.0370, 12036.4607, 7465, 1.7551, 5088.6288, 7387, 3.5032, 3154.6871, 7355,
	4.6793, 801.8209, 6963, 0.8330, 9437.7629, 6245, 3.9776, 8827.3903, 6115, 1.8184, 7084.8968, 5696, 2.7843,
	6286.5990, 5612, 4.3869, 14143.4952, 5558, 3.4701, 6279.5527, 5199, 0.1891, 12139.5535, 5161, 1.3328, 1748.0164,
	5115, 0.2831, 5856.4777, 4900, 0.4874, 1194.4470, 4104, 5.3682, 8429.2413, 4094, 2.3985, 19651.0485, 3920,
	6.1683, 10447.3878, 3677, 6.0413, 10213.2855, 3660, 2.5696, 1059.3819, 3595, 1.7088, 2352.8662, 3557, 1.7760,
	6812.7668, 3329, 0.5931, 17789.8456, 3041, 0.4429, 83996.8473, 3005, 2.7398, 1349.8674, 2535, 3.1647, 4690.4798,
	2474, 0.2148, 3.5904, 2366, 0.4847, 8031.0923, 2357, 2.0653, 3340.6124, 2282, 5.2220, 4705.7323, 2189, 5.5559,
	553.5694, 2142, 1.4256, 16730.4637, 2109, 4.1483, 951.7184, 2030, 0.3713, 283.8593, 1992, 5.2221, 12168.0027,
	1986, 5.7747, 6309.3742, 1912, 3.8222, 23581.2582, 1889, 5.3863, 149854.4001, 1790, 2.2149, 13367.9726, 1748,
	4.5605, 135.0651, 1622, 5.9884, 11769.8537, 1508, 4.1957, 6256.7775, 1442, 4.1932, 242.7286, 1435, 3.7236,
	38.0277, 1397, 4.4014, 6681.2249, 1362, 1.8893, 7632.9433, 1250, 1.1305, 5.5229, 1205, 2.6223, 955.5997, 1200,
	1.0035, 632.7837, 1129, 0.1774, 4164.3120, 1083, 0.3273, 103.0928, 1052, 0.9387, 11926.2544, 1050, 5.3591,
	1592.5960, 1033, 6.1998, 6438.4962, 1001, 6.0291, 5746.2713, 980, 0.999, 11371.705, 980, 5.244, 27511.468, 938,
	2.624, 5760.498, 923, 0.483, 522.577, 922, 4.571, 4292.331, 905, 5.337, 6386.169, 862, 4.165, 7058.598, 841,
	3.299, 7234.794, 836, 4.539, 25132.303, 813, 6.112, 4732.031, 812, 6.271, 426.598, 801, 5.821, 28.449, 787,
	0.996, 5643.179, 776, 2.957, 23013.540, 769, 3.121, 7238.676, 758, 3.974, 11499.656, 735, 4.386, 316.392, 731,
	0.607, 11513.883, 719, 3.998, 74.782, 706, 0.323, 263.084, 676, 5.911, 90955.552, 663, 3.665, 17298.182, 653,
	5.791, 18073.705, 630, 4.717, 6836.645, 615, 1.458, 233141.314, 612, 1.075, 19804.827, 596, 3.321, 6283.009,
	596, 2.876, 6283.143, 555, 2.452, 12352.853, 541, 5.392, 419.485, 531, 0.382, 31441.678, 519, 4.065, 6208.294,
	513, 2.361, 10973.556, 494, 5.737, 9917.697, 450, 3.272, 11015.106, 449, 3.653, 206.186, 447, 2.064, 7079.374,
	435, 4.423, 5216.580, 421, 1.906, 245.832, 413, 0.921, 3738.761, 402, 0.840, 20.355, 387, 1.826, 11856.219, 379,
	2.344, 3.881, 374, 2.954, 3128.389, 370, 5.031, 536.805, 365, 1.018, 16200.773, 365, 1.083, 88860.057, 352,
	5.978, 3894.182, 352, 2.056, 244287.600, 351, 3.713, 6290.189, 340, 1.106, 14712.317, 339, 0.978, 8635.942, 339,
	3.202, 5120.601, 333, 0.837, 6496.375, 325, 3.479, 6133.513, 316, 5.089, 21228.392, 316, 1.328, 10873.986, 309,
	3.646, 10.637, 303, 1.802, 35371.887, 296, 3.397, 9225.539, 288, 6.026, 154717.610, 281, 2.585, 14314.168, 262,
	3.856, 266.607, 262, 2.579, 22483.849, 257, 1.561, 23543.231, 255, 3.949, 1990.745, 251, 3.744, 10575.407, 240,
	1.161, 10984.192, 238, 0.106, 7.046, 236, 4.272, 6040.347, 234, 3.577, 10969.965, 211, 3.714, 65147.620, 210,
	0.754, 13521.751, 207, 4.228, 5650.292, 202, 0.814, 170.673, 201, 4.629, 6037.244, 200, 0.381, 6172.870, 199,
	3.933, 6206.810, 199, 5.197, 6262.300, 197, 1.046, 18209.330, 195, 1.070, 5230.807, 195, 4.869, 36.028, 194,
	4.313, 6244.943, 192, 1.229, 709.933, 192, 5.595, 6282.096, 192, 0.602, 6284.056, 189, 3.744, 23.878, 188,
	1.904, 15.252, 188, 0.867, 22003.915, 182, 3.681, 15110.466, 181, 0.491, 1.484, 179, 3.222, 39302.097, 179,
	1.259, 12559.038,
	62833196674749, 0.000000000000, 0.000000000000, 20605886, 2.67823456, 6283.07584999, 430343, 2.635127,
	12566.151700, 42526, 1.59047, 3.52312, 11926, 5.79557, 26.29832, 10898, 2.96618, 1577.34354, 9348, 2.5921,
	18849.2275, 7212, 1.1385, 529.6910, 6777, 1.8747, 398.1490, 6733, 4.4092, 5507.5532, 5903, 2.8880, 5223.6939,
	5598, 2.1747, 155.4204, 4541, 0.3980, 796.2980, 3637, 0.4662, 775.5226, 2896, 2.6471, 7.1135, 2084, 5.3414,
	0.9803, 1910, 1.8463, 5486.7778, 1851, 4.9686, 213.2991, 1729, 2.9912, 6275.9623, 1623, 0.0322, 2544.3144, 1583,
	1.4305, 2146.1654, 1462, 1.2053, 10977.0788, 1246, 2.8343, 1748.0164, 1188, 3.2580, 5088.6288, 1181, 5.2738,
	1194.4470, 1151, 2.0750, 4694.0030, 1064, 0.7661, 553.5694, 997, 1.303, 6286.599, 972, 4.239, 1349.867, 945,
	2.700, 242.729, 858, 5.645, 951.718, 758, 5.301, 2352.866, 639, 2.650, 9437.763, 610, 4.666, 4690.480, 583,
	1.766, 1059.382, 531, 0.909, 3154.687, 522, 5.661, 71430.696, 520, 1.854, 801.821, 504, 1.425, 6438.496, 433,
	0.241, 6812.767, 426, 0.774, 10447.388, 413, 5.240, 7084.897, 374, 2.001, 8031.092, 356, 2.429, 14143.495, 350,
	4.800, 6279.553, 337, 0.888, 12036.461, 337, 3.862, 1592.596, 325, 3.400, 7632.943, 322, 0.616, 8429.241, 318,
	3.188, 4705.732, 297, 6.070, 4292.331, 295, 1.431, 5746.271, 290, 2.325, 20.355, 275, 0.935, 5760.498, 270,
	4.804, 7234.794, 253, 6.223, 6836.645, 228, 5.003, 17789.846, 225, 5.672, 11499.656, 215, 5.202, 11513.883, 208,
	3.955, 10213.286, 208, 2.268, 522.577, 206, 2.224, 5856.478, 206, 2.550, 25132.303, 203, 0.910, 6256.778, 189,
	0.532, 3340.612, 188, 4.735, 83996.847, 179, 1.474, 4164.312, 178, 3.025, 5.523, 177, 3.026, 5753.385, 159,
	4.637, 3.286, 157, 6.124, 5216.580, 155, 3.077, 6681.225, 154, 4.200, 13367.973, 143, 1.191, 3894.182, 138,
	3.093, 135.065, 136, 4.245, 426.598, 134, 5.765, 6040.347, 128, 3.085, 5643.179, 127, 2.092, 6290.189, 125,
	3.077, 11926.254, 125, 3.445, 536.805, 114, 3.244, 12168.003, 112, 2.318, 16730.464, 111, 3.901, 11506.770, 111,
	5.320, 23.878, 105, 3.750, 7860.419, 103, 2.447, 1990.745, 96, 0.82, 3.88, 96, 4.08, 6127.66, 91, 5.42, 206.19,
	91, 0.42, 7079.37, 88, 5.17, 11790.63, 81, 0.34, 9917.70, 80, 3.89, 10973.56, 78, 2.40, 1589.07, 78, 2.58,
	11371.70, 77, 3.98, 955.60, 77, 3.36, 36.03, 76, 1.30, 103.09, 75, 5.18, 10969.97, 75, 4.96, 6496.37, 73, 5.21,
	38.03, 72, 2.65, 6309.37, 70, 5.61, 3738.76, 69, 2.60, 3496.03, 69, 0.39, 15.25, 69, 2.78, 20.78, 65, 1.13,
	7058.60, 64, 4.28, 28.45, 61, 5.63, 10984.19, 60, 0.73, 419.48, 60, 5.28, 10575.41, 58, 5.55, 17298.18, 58,
	3.19, 4732.03,
	5291887, 0.0000000, 0.0000000, 871984, 1.072097, 6283.075850, 30913, 0.86729, 12566.15170, 2734, 0.0530, 3.5231,
	1633, 5.1883, 26.2983, 1575, 3.6846, 155.4204, 954, 0.757, 18849.228, 894, 2.057, 77713.771, 695, 0.827,
	775.523, 506, 4.663, 1577.344, 406, 1.031, 7.114, 381, 3.441, 5573.143, 346, 5.141, 796.298, 317, 6.053,
	5507.553, 302, 1.192, 242.729, 289, 6.117, 529.691, 271, 0.306, 398.149, 254, 2.280, 553.569, 237, 4.381,
	5223.694, 208, 3.754, 0.980, 168, 0.902, 951.718, 153, 5.759, 1349.867, 145, 4.364, 1748.016, 134, 3.721,
	1194.447, 125, 2.948, 6438.496, 122, 2.973, 2146.165, 110, 1.271, 161000.686, 104, 0.604, 3154.687, 100, 5.986,
	6286.599, 92, 4.80, 5088.63, 89, 5.23, 7084.90, 83, 3.31, 213.30, 76, 3.42, 5486.78, 71, 6.19, 4690.48, 68,
	3.43, 4694.00, 65, 1.60, 2544.31, 64, 1.98, 801.82, 61, 2.48, 10977.08, 50, 1.44, 6836.65, 49, 2.34, 1592.60,
	46, 1.31, 4292.33, 46, 3.81, 149854.40, 43, 0.04, 7234.79, 40, 4.94, 7632.94, 39, 1.57, 71430.70, 38, 3.17,
	6309.37, 35, 0.99, 6040.35, 35, 0.67, 1059.38, 31, 3.18, 2352.87, 31, 3.55, 8031.09, 30, 1.92, 10447.39, 30,
	2.52, 6127.66, 28, 4.42, 9437.76, 28, 2.71, 3894.18, 27, 0.67, 25132.30, 26, 5.27, 6812.77, 25, 0.55, 6279.55,
	23, 1.38, 4705.73, 22, 0.64, 6256.78, 20, 6.07, 640.88,
	28923, 5.84384, 6283.07585, 3496, 0.0000, 0.0000, 1682, 5.4877, 12566.1517, 296, 5.196, 155.420, 129, 4.722,
	3.523, 71, 5.30, 18849.23, 64, 5.97, 242.73, 40, 3.79, 553.57,
	11408, 3.14159, 0.00000, 772, 4.134, 6283.076, 77, 3.84, 12566.15, 42, 0.42, 155.42,
	88, 3.14, 0.00, 17, 2.77, 6283.08, 5, 2.01, 155.42, 3, 2.21, 12566.15,
	27962, 3.19870, 84334.66158, 10164, 5.42249, 5507.55324, 8045, 3.8801, 5223.6939, 4381, 3.7044, 2352.8662, 3193,
	4.0003, 1577.3435, 2272, 3.9847, 1047.7473, 1814, 4.9837, 6283.0758, 1639, 3.5646, 5856.4777, 1444, 3.7028,
	9437.7629, 1430, 3.4112, 10213.2855, 1125, 4.8282, 14143.4952, 1090, 2.0857, 6812.7668, 1037, 4.0566,
	71092.8814, 971, 3.473, 4694.003, 915, 1.142, 6620.890, 878, 4.440, 5753.385, 837, 4.993, 7084.897, 770, 5.554,
	167621.576, 719, 3.602, 529.691, 692, 4.326, 6275.962, 558, 4.410, 7860.419, 529, 2.484, 4705.732, 521, 6.250,
	18073.705,
	903, 3.897, 5507.553, 618, 1.730, 5223.694, 380, 5.244, 2352.866,
	166, 1.627, 84334.662,
	10001398880, 0.00000000000, 0.00000000000, 167069963, 3.098463508, 6283.075849991, 1395602, 3.0552461,
	12566.1517000, 308372, 5.198467, 77713.771468, 162846, 1.173877, 5753.384885, 157557, 2.846852, 7860.419392,
	92480, 5.45292, 11506.76977, 54244, 4.56409, 3930.20970, 47211, 3.66100, 5884.92685, 34598, 0.96369, 5507.55324,
	32878, 5.89984, 5223.69392, 30678, 0.29867, 5573.14280, 24319, 4.27350, 11790.62909, 21183, 5.84715, 1577.34354,
	18575, 5.02194, 10977.07880, 17484, 3.01194, 18849.22755, 10984, 5.05511, 5486.77784, 9832, 0.8868, 6069.7768,
	8650, 5.6896, 15720.8388, 8583, 1.2708, 161000.6857, 6490, 0.2725, 17260.1547, 6292, 0.9218, 529.6910, 5706,
	2.0137, 83996.8473, 5574, 5.2416, 71430.6956, 4938, 3.2450, 2544.3144, 4696, 2.5781, 775.5226, 4466, 5.5372,
	9437.7629, 4252, 6.0111, 6275.9623, 3897, 5.3607, 4694.0030, 3825, 2.3926, 8827.3903, 3749, 0.8295, 19651.0485,
	3696, 4.9011, 12139.5535, 3566, 1.6747, 12036.4607, 3454, 1.8427, 2942.4634, 3319, 0.2437, 7084.8968, 3192,
	0.1837, 5088.6288, 3185, 1.7778, 398.1490, 2846, 1.2134, 6286.5990, 2779, 1.8993, 6279.5527, 2628, 4.5890,
	10447.3878, 2460, 3.7866, 8429.2413, 2393, 4.9960, 5856.4777, 2359, 0.2687, 796.2980, 2329, 2.8078, 14143.4952,
	2210, 1.9500, 3154.6871, 2035, 4.6527, 2146.1654, 1951, 5.3823, 2352.8662, 1883, 0.6731, 149854.4001, 1833,
	2.2535, 23581.2582, 1796, 0.1987, 6812.7668, 1731, 6.1520, 16730.4637, 1717, 4.4332, 10213.2855, 1619, 5.2316,
	17789.8456, 1381, 5.1896, 8031.0923, 1364, 3.6852, 4705.7323, 1314, 0.6529, 13367.9726, 1041, 4.3329,
	11769.8537, 1017, 1.5939, 4690.4798, 998, 4.201, 6309.374, 966, 3.676, 27511.468, 874, 6.064, 1748.016, 779,
	3.674, 12168.003, 771, 0.312, 7632.943, 756, 2.626, 6256.778, 746, 5.648, 11926.254, 693, 2.924, 6681.225, 680,
	1.423, 23013.540, 674, 0.563, 3340.612, 663, 5.661, 11371.705, 659, 3.136, 801.821, 648, 2.650, 19804.827, 615,
	3.029, 233141.314, 612, 5.134, 1194.447, 563, 4.341, 90955.552, 552, 2.091, 17298.182, 534, 5.100, 31441.678,
	531, 2.407, 11499.656, 523, 4.624, 6438.496, 513, 5.324, 11513.883, 477, 0.256, 11856.219, 461, 1.722, 7234.794,
	458, 3.766, 6386.169, 458, 4.466, 5746.271, 423, 1.055, 5760.498, 422, 1.557, 7238.676, 415, 2.599, 7058.598,
	401, 3.030, 1059.382, 397, 1.201, 1349.867, 379, 4.907, 4164.312, 360, 5.707, 5643.179, 352, 3.626, 244287.600,
	348, 0.761, 10973.556, 342, 3.001, 4292.331, 336, 4.546, 4732.031, 334, 3.138, 6836.645, 324, 4.164, 9917.697,
	316, 1.691, 11015.106, 307, 0.238, 35371.887, 298, 1.306, 6283.143, 298, 1.750, 6283.009, 293, 5.738, 16200.773,
	286, 5.928, 14712.317, 281, 3.515, 21228.392, 280, 5.663, 8635.942, 277, 0.513, 26.298, 268, 4.207, 18073.705,
	266, 0.900, 12352.853, 260, 2.962, 25132.303, 255, 2.477, 6208.294, 242, 2.800, 709.933, 231, 1.054, 22483.849,
	229, 1.070, 14314.168, 216, 1.314, 154717.610, 215, 6.038, 10873.986, 200, 0.561, 7079.374, 198, 2.614, 951.718,
}

// XL1 月球黄经计算表
var XL1 = [4][300]float64{
	{22639.586, 0.78475822, 8328.691424623, 1.5229241, 25.0719, -0.123598, 4586.438, 0.1873974, 7214.06286536, -2.184756, -18.860, 0.08280, 2369.914, 2.5429520, 15542.75428998, -0.661832, 6.212, -0.04080, 769.026, 3.140313, 16657.38284925, 3.04585, 50.144, -0.2472, 666.418, 1.527671, 628.30195521, -0.02664, 0.062, -0.0054, 411.596, 4.826607, 16866.9323150, -1.28012, -1.07, -0.0059, 211.656, 4.115028, -1114.6285593, -3.70768, -43.93, 0.2064, 205.436, 0.230523, 6585.7609101, -2.15812, -18.92, 0.0882, 191.956, 4.898507, 23871.4457146, 0.86109, 31.28, -0.164, 164.729, 2.586078, 14914.4523348, -0.6352, 6.15, -0.035, 147.321, 5.45530, -7700.3894694, -1.5496, -25.01, 0.118, 124.988, 0.48608, 7771.3771450, -0.3309, 3.11, -0.020, 109.380, 3.88323, 8956.9933798, 1.4963, 25.13, -0.129, 55.177, 5.57033, -1324.1780250, 0.6183, 7.3, -0.035, 45.100, 0.89898, 25195.623740, 0.2428, 24.0, -0.129, 39.533, 3.81213, -8538.240890, 2.8030, 26.1, -0.118, 38.430, 4.30115, 22756.817155, -2.8466, -12.6, 0.042, 36.124, 5.49587, 24986.074274, 4.5688, 75.2, -0.371, 30.773, 1.94559, 14428.125731, -4.3695, -37.7, 0.166, 28.397, 3.28586, 7842.364821, -2.2114, -18.8, 0.077, 24.358, 5.64142, 16171.056245, -0.6885, 6.3, -0.046, 18.585, 4.41371, -557.314280, -1.8538, -22.0, 0.10, 17.954, 3.58454, 8399.679100, -0.3576, 3.2, -0.03, 14.530, 4.9416, 23243.143759, 0.888, 31.2, -0.16, 14.380, 0.9709, 32200.137139, 2.384, 56.4, -0.29, 14.251, 5.7641, -2.301200, 1.523, 25.1, -0.12, 13.899, 0.3735, 31085.508580, -1.324, 12.4, -0.08, 13.194, 1.7595, -9443.319984, -5.231, -69.0, 0.33, 9.679, 3.0997, -16029.080894, -3.072, -50.1, 0.24, 9.366, 0.3016, 24080.995180, -3.465, -19.9, 0.08, 8.606, 4.1582, -1742.930514, -3.681, -44.0, 0.21, 8.453, 2.8416, 16100.068570, 1.192, 28.2, -0.14, 8.050, 2.6292, 14286.150380, -0.609, 6.1, -0.03, 7.630, 6.2388, 17285.684804, 3.019, 50.2, -0.25, 7.447, 1.4845, 1256.603910, -0.053, 0.1, -0.01, 7.371, 0.2736, 5957.458955, -2.131, -19.0, 0.09, 7.063, 5.6715, 33.757047, -0.308, -3.6, 0.02, 6.383, 4.7843, 7004.513400, 2.141, 32.4, -0.16, 5.742, 2.6572, 32409.686605, -1.942, 5, -0.05, 4.374, 4.3443, 22128.51520, -2.820, -13, 0.05, 3.998, 3.2545, 33524.31516, 1.766, 49, -0.25, 3.210, 2.2443, 14985.44001, -2.516, -16, 0.06, 2.915, 1.7138, 24499.74767, 0.834, 31, -0.17, 2.732, 1.9887, 13799.82378, -4.343, -38, 0.17, 2.568, 5.4122, -7072.08751, -1.576, -25, 0.11, 2.521, 3.2427, 8470.66678, -2.238, -19, 0.07},
	{1.67680, 4.66926, 628.301955, -0.0266, 0.1, -0.005, 0.51642, 3.3721, 6585.760910, -2.158, -18.9, 0.09, 0.41383, 5.7277, 14914.452335, -0.635, 6.2, -0.04, 0.37115, 3.9695, 7700.389469, 1.550, 25.0, -0.12, 0.27560, 0.7416, 8956.993380, 1.496, 25.1, -0.13, 0.24599, 4.2253, -2.301200, 1.523, 25.1, -0.12, 0.07118, 0.1443, 7842.36482, -2.211, -19, 0.08, 0.06128, 2.4998, 16171.05625, -0.688, 6, 0, 0.04516, 0.443, 8399.67910, -0.36, 3, 0, 0.04048, 5.771, 14286.15038, -0.61, 6, 0, 0.03747, 4.626, 1256.60391, -0.05, 0, 0, 0.03707, 3.415, 5957.45895, -2.13, -19, 0.1, 0.03649, 1.800, 23243.14376, 0.89, 31, -0.2, 0.02438, 0.042, 16029.08089, 3.07, 50, -0.2, 0.02165, 1.017, -1742.93051, -3.68, -44, 0.2, 0.01923, 3.097, 17285.68480, 3.02, 50, -0.3, 0.01692, 1.280, 0.3286, 1.52, 25, -0.1, 0.01361, 0.298, 8326.3902, 3.05, 50, -0.2, 0.01293, 4.013, 7072.0875, 1.58, 25, -0.1, 0.01276, 4.413, 8330.9926, 0, 0, 0, 0.01270, 0.101, 8470.6668, -2.24, -19, 0.1},
	{0.004870, 4.6693, 628.30196, -0.027, 0, -0.01, 0.002280, 2.6746, -2.30120, 1.523, 25, -0.12, 0.001500, 3.372, 6585.76091, -2.16, -19, 0.1, 0.001200, 5.728, 14914.45233, -0.64, 6, 0, 0.001080, 3.969, 7700.38947, 1.55, 25, -0.1, 0.000800, 0.742, 8956.99338, 1.50, 25, -0.1, 0.000254, 6.002, 0.3286, 1.52, 25, -0.1, 0.000210, 0.144, 7842.3648, -2.21, -19, 0, 0.000180, 2.500, 16171.0562, -0.7, 6, 0, 0.000130, 0.44, 8399.6791, -0.4, 3, 0},
	{0.00001200, 1.041, -2.3012, 1.52, 25, -0.1, 0.00000170, 0.31, -0.711, 0, 0, 0},
}

func nutationLon2(t float64) float64 {
	a := -1.742 * t
	t2 := t * t
	dl := float64(0)
	j := len(NutB)
	for i := 0; i < j; i += 5 {
		dl += (NutB[i+3] + a) * math.Sin(NutB[i]+NutB[i+1]*t+NutB[i+2]*t2)
		a = 0
	}
	return dl / 100 / SecondPerRad
}

func eLon(t float64, n int) float64 {
	t /= 10
	v := float64(0)
	tn := float64(1)
	pn := 1
	m0 := XL0[pn+1] - XL0[pn]
	for i := 0; i < 6; i++ {
		n1 := int(XL0[pn+i])
		n2 := int(XL0[pn+1+i])
		n0 := n2 - n1
		if n0 == 0 {
			continue
		}
		m := 0
		if n < 0 {
			m = n2
		} else {
			m = int(float64(3*n*n0)/m0+0.5) + n1
			if i != 0 {
				m += 3
			}
			if m > n2 {
				m = n2
			}
		}
		c := float64(0)
		for j := n1; j < m; j += 3 {
			c += XL0[j] * math.Cos(XL0[j+1]+t*XL0[j+2])
		}
		v += c * tn
		tn = tn * t
	}
	v /= XL0[0]
	t2 := t * t
	t3 := t2 * t
	return v + (-0.0728-2.7702*t-1.1019*t2-0.0996*t3)/SecondPerRad
}

func gxcSunLon(t float64) float64 {
	t2 := t * t
	return -20.49552 * (1 + (0.016708634-0.000042037*t-0.0000001267*t2)*math.Cos(-0.043126+628.301955*t-0.000002732*t2)) / SecondPerRad
}

func ev(t float64) float64 {
	f := 628.307585 * t
	return 628.332 + 21*math.Sin(1.527+f) + 0.44*math.Sin(1.48+f*2) + 0.129*math.Sin(5.82+f)*t + 0.00055*math.Sin(4.21+f)*t*t
}

func saLon(t float64, n int) float64 {
	return eLon(t, n) + nutationLon2(t) + gxcSunLon(t) + math.Pi
}

func dtExt(y float64, jsd float64) float64 {
	dy := (y - 1820) / 100
	return -20 + jsd*dy*dy
}

func dtCalc(y float64) float64 {
	size := len(DtAt)
	y0 := DtAt[size-2]
	t0 := DtAt[size-1]
	if y >= y0 {
		jsd := float64(31)
		if y > y0+100 {
			return dtExt(y, jsd)
		}
		v := dtExt(y, jsd)
		dv := dtExt(y0, jsd) - t0
		return v - dv*(y0+100-y)/100
	}
	i := 0
	for ; i < size; i += 5 {
		if y < DtAt[i+5] {
			break
		}
	}
	t1 := (y - DtAt[i]) / (DtAt[i+5] - DtAt[i]) * 10
	t2 := t1 * t1
	t3 := t2 * t1
	return DtAt[i+1] + DtAt[i+2]*t1 + DtAt[i+3]*t2 + DtAt[i+4]*t3
}

func DtT(t float64) float64 {
	return dtCalc(t/365.2425+2000) / SecondPerDay
}

func SaLonT(w float64) float64 {
	v := 628.3319653318
	t := (w - 1.75347 - math.Pi) / v
	v = ev(t)
	t += (w - saLon(t, 10)) / v
	return t + (w-saLon(t, -1))/ev(t)
}

func saLonT2(w float64) float64 {
	v := 628.3319653318
	t := (w - 1.75347 - math.Pi) / v
	t -= (0.000005297*t*t + 0.0334166*math.Cos(4.669257+628.307585*t) + 0.0002061*math.Cos(2.67823+628.307585*t)*t) / v
	return t + (w-eLon(t, 8)-math.Pi+(20.5+17.2*math.Sin(2.1824-33.75705*t))/SecondPerRad)/v
}

func qiHigh(w float64) float64 {
	t := saLonT2(w) * 36525
	t = t - DtT(t) + OneThird
	v := math.Mod(t+0.5, 1) * SecondPerDay
	if v < 1200 || v > SecondPerDay-1200 {
		t = SaLonT(w)*36525 - DtT(t) + OneThird
	}
	return t
}

func qiLow(w float64) float64 {
	v := 628.3319653318
	t := (w - 4.895062166) / v
	t -= (53*t*t + 334116*math.Cos(4.67+628.307585*t) + 2061*math.Cos(2.678+628.3076*t)*t) / v / 10000000
	n := 48950621.66 + 6283319653.318*t + 53*t*t + 334166*math.Cos(4.669257+628.307585*t) + 3489*math.Cos(4.6261+1256.61517*t) + 2060.6*math.Cos(2.67823+628.307585*t)*t - 994 - 834*math.Sin(2.1824-33.75705*t)
	t -= (n/10000000-w)/628.332 + (32*(t+1.8)*(t+1.8)-20)/SecondPerDay/36525
	return t*36525 + OneThird
}

// CalcQi 计算节气
func CalcQi(jd float64) float64 {
	size := len(QiKb)
	d := float64(0)
	i := 0
	pc := float64(7)
	jd += 2451545
	f1 := QiKb[0] - pc
	f2 := QiKb[size-1] - pc
	f3 := float64(2436935)
	if jd < f1 || jd >= f3 {
		d = math.Floor(qiHigh(math.Floor((jd+pc-2451259)/365.2422*24)*math.Pi/12) + 0.5)
	} else if jd >= f1 && jd < f2 {
		for i = 0; i < size; i += 2 {
			if jd+pc < QiKb[i+2] {
				break
			}
		}
		d = QiKb[i] + QiKb[i+1]*math.Floor((jd+pc-QiKb[i])/QiKb[i+1])
		d = math.Floor(d + 0.5)
		if d == 1683460 {
			d++
		}
		d -= 2451545
	} else if jd >= f2 && jd < f3 {
		d = math.Floor(qiLow(math.Floor((jd+pc-2451259)/365.2422*24)*math.Pi/12) + 0.5)
		from := int((jd - f2) / 365.2422 * 24)
		n := QB[from : from+1]
		if strings.Compare("1", n) == 0 {
			d += 1
		} else if strings.Compare("2", n) == 0 {
			d -= 1
		}
	}
	return d
}

// CalcShuo 计算朔日
func CalcShuo(jd float64) float64 {
	size := len(ShuoKb)
	d := float64(0)
	i := 0
	pc := float64(14)
	jd += 2451545
	f1 := ShuoKb[0] - pc
	f2 := ShuoKb[size-1] - pc
	f3 := float64(2436935)
	if jd < f1 || jd >= f3 {
		d = math.Floor(shuoHigh(math.Floor((jd+pc-2451551)/29.5306)*Pi2) + 0.5)
	} else if jd >= f1 && jd < f2 {
		for i = 0; i < size; i += 2 {
			if jd+pc < ShuoKb[i+2] {
				break
			}
		}
		d = ShuoKb[i] + ShuoKb[i+1]*math.Floor((jd+pc-ShuoKb[i])/ShuoKb[i+1])
		d = math.Floor(d + 0.5)
		if d == 1683460 {
			d++
		}
		d -= 2451545
	} else if jd >= f2 && jd < f3 {
		d = math.Floor(shuoLow(math.Floor((jd+pc-2451551)/29.5306)*Pi2) + 0.5)
		from := int((jd - f2) / 29.5306)
		n := SB[from : from+1]
		if strings.Compare("1", n) == 0 {
			d += 1
		} else if strings.Compare("2", n) == 0 {
			d -= 1
		}
	}
	return d
}

func mLon(t float64, n int) float64 {
	ob := XL1
	obl := len(ob[0])
	tn := float64(1)
	v := float64(0)
	t2 := t * t
	t3 := t2 * t
	t4 := t3 * t
	t5 := t4 * t
	tx := t - 10
	v += (3.81034409 + 8399.684730072*t - 3.319e-05*t2 + 3.11e-08*t3 - 2.033e-10*t4) * SecondPerRad
	v += 5028.792262*t + 1.1124406*t2 + 0.00007699*t3 - 0.000023479*t4 - 0.0000000178*t5
	if tx > 0 {
		v += -0.866 + 1.43*tx + 0.054*tx*tx
	}
	t2 /= 1e4
	t3 /= 1e8
	t4 /= 1e8

	n *= 6
	if n < 0 {
		n = obl
	}
	x := len(ob)
	for i := 0; i < x; i++ {
		f := ob[i]
		l := len(f)
		m := int(float64(n*l)/float64(obl) + 0.5)
		if i > 0 {
			m += 6
		}
		if m >= l {
			m = l
		}
		c := float64(0)
		for j := 0; j < m; j += 6 {
			c += f[j] * math.Cos(f[j+1]+t*f[j+2]+t2*f[j+3]+t3*f[j+4]+t4*f[j+5])
		}
		v += c * tn
		tn *= t
	}
	return v / SecondPerRad
}

func mv(t float64) float64 {
	v := 8399.71 - 914*math.Sin(0.7848+8328.691425*t+0.0001523*t*t)
	return v - (179*math.Sin(2.543+15542.7543*t) + 160*math.Sin(0.1874+7214.0629*t) + 62*math.Sin(3.14+16657.3828*t) + 34*math.Sin(4.827+16866.9323*t) + 22*math.Sin(4.9+23871.4457*t) + 12*math.Sin(2.59+14914.4523*t) + 7*math.Sin(0.23+6585.7609*t) + 5*math.Sin(0.9+25195.624*t) + 5*math.Sin(2.32-7700.3895*t) + 5*math.Sin(3.88+8956.9934*t) + 5*math.Sin(0.49+7771.3771*t))
}

func msaLon(t float64, mn int, sn int) float64 {
	return mLon(t, mn) + (-3.4e-6) - (eLon(t, sn) + gxcSunLon(t) + math.Pi)
}

func msaLonT(w float64) float64 {
	v := 7771.37714500204
	t := (w + 1.08472) / v
	t += (w - msaLon(t, 3, 3)) / v
	v = mv(t) - ev(t)
	t += (w - msaLon(t, 20, 10)) / v
	return t + (w-msaLon(t, -1, 60))/v
}

func msaLonT2(w float64) float64 {
	v := 7771.37714500204
	t := (w + 1.08472) / v
	t2 := t * t
	t -= (-0.00003309*t2 + 0.10976*math.Cos(0.784758+8328.6914246*t+0.000152292*t2) + 0.02224*math.Cos(0.18740+7214.0628654*t-0.00021848*t2) - 0.03342*math.Cos(4.669257+628.307585*t)) / v
	t2 = t * t
	l := mLon(t, 20) - (4.8950632 + 628.3319653318*t + 0.000005297*t2 + 0.0334166*math.Cos(4.669257+628.307585*t) + 0.0002061*math.Cos(2.67823+628.307585*t)*t + 0.000349*math.Cos(4.6261+1256.61517*t) - 20.5/SecondPerRad)
	v = 7771.38 - 914*math.Sin(0.7848+8328.691425*t+0.0001523*t2) - 179*math.Sin(2.543+15542.7543*t) - 160*math.Sin(0.1874+7214.0629*t)
	return t + (w-l)/v
}

func shuoHigh(w float64) float64 {
	t := msaLonT2(w) * 36525
	t = t - DtT(t) + OneThird
	v := math.Mod(t+0.5, 1) * SecondPerDay
	if v < 1800 || v > SecondPerDay-1800 {
		t = msaLonT(w)*36525 - DtT(t) + OneThird
	}
	return t
}

func shuoLow(w float64) float64 {
	v := 7771.37714500204
	t := (w + 1.08472) / v
	t -= (-0.0000331*t*t+0.10976*math.Cos(0.785+8328.6914*t)+0.02224*math.Cos(0.187+7214.0629*t)-0.03342*math.Cos(4.669+628.3076*t))/v + (32*(t+1.8)*(t+1.8)-20)/SecondPerDay/36525
	return t*36525 + OneThird
}

func QiAccurate(w float64) float64 {
	t := SaLonT(w) * 36525
	return t - DtT(t) + OneThird
}

func QiAccurate2(jd float64) float64 {
	d := math.Pi / 12
	w := math.Floor((jd+293)/365.2422*24) * d
	a := QiAccurate(w)
	if a-jd > 5 {
		return QiAccurate(w - d)
	}
	if a-jd < -5 {
		return QiAccurate(w + d)
	}
	return a
}

